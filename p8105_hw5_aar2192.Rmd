---
title: "p8105_hw5_aar2192"
author: "Amadeia Rector"
date: "11/6/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)
library(tidyverse)
library(purrr)
library(ggplot2)
theme_set(theme_bw() + theme(legend.position = "bottom"))
```

# Problem 1

## Part A

- Start with a dataframe containing all file names; the list.files function will help

```{r}
longitudinal_df =
    tibble(file_name = list.files(path = "./data")) 

```
This created a data frame with just the names of the csv files.

## Part B

- Iterate over file names and read in data for each subject using purrr::map and saving the result as a new variable in the dataframe

```{r}
  longitudinal_df =
    tibble(participant = list.files(path = "./data"),
           csv_file = str_c(path = "./data/", participant)) %>% 
    mutate(data = map(csv_file, read_csv)) %>% 
    unnest 
```
Using map, I read a string with the complete file names using the "read_csv" function.

## Part C

- Tidy the result; manipulate file names to include control arm and subject ID, make sure weekly observations are “tidy”, and do any other tidying that’s necessary

```{r}
longitudinal_df =
    tibble(participant = list.files(path = "./data"),
           csv_file = str_c(path = "./data/", participant)) %>% 
    mutate(data = map(csv_file, read_csv)) %>% 
    unnest %>%
    separate(participant, into = c("participant_id", "trash"), sep = ".c") %>% 
  mutate(study_arm = participant_id) %>%
  mutate(study_arm = str_replace(study_arm, "con", "control")) %>% 
  mutate(study_arm = str_replace(study_arm, "exp", "experiment")) %>% 
  separate(study_arm, into = c("study_arm", "trash1"), sep = "_") %>% 
  select(participant_id, study_arm, everything(), -starts_with("trash"), -csv_file) %>% 
  janitor::clean_names() %>% 
  gather(key = week, value = observation, week_1:week_8) %>% 
  separate(week, into = c("trash", "week"), sep = "_") %>% 
  select(-trash) 
```
Building on Part B, I tidied my newly created data set by renaming some variables, removing unnecessary variables, creating a variable based on study arm, and gathering the week variables into one column. 

## Part D

- Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups.

```{r}
longitudinal_df %>% 
  ggplot(aes(x = week, y = observation, group = participant_id, color = study_arm)) +
  geom_path() + 
  labs(title = "Observations over Time per Subject",
       x = "Time (weeks)",
       y = "Observations") + 
  viridis::scale_color_viridis(
    name = "Study arm", 
    discrete = TRUE) +
  theme(plot.title = element_text(hjust = 0.5))
```
 
### Plot description:

Given the spaghetti plot above, it appears that subjects in the **"experiment"** arm have _higher_ observations overall compared to the **"control"** arm.  

While there is some overlap/crossing of lines between the "control" and "experiment" subjects with regard to observations, it seems that the highest observation among subjects in the "control" arm is at around 4.5 compared to above 7.5 among subjects in the "experiment" arm. The lowest observation is slightly above -2.5 among subjects in the "control" arm compared to just above -1 among subjects in the "experiment" arm.

# Problem 2
