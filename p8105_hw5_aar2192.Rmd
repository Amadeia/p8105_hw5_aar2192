---
title: "p8105_hw5_aar2192"
author: "Amadeia Rector"
date: "11/6/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)
library(tidyverse)
library(purrr)
library(ggplot2)
theme_set(theme_bw() + theme(legend.position = "bottom"))
```

# Problem 1

## Part A

- Start with a dataframe containing all file names; the list.files function will help

```{r}
longitudinal_df =
    tibble(file_name = list.files(path = "./data")) 

```
This created a data frame with just the names of the csv files.

## Part B

- Iterate over file names and read in data for each subject using purrr::map and saving the result as a new variable in the dataframe

```{r}
  longitudinal_df =
    tibble(participant = list.files(path = "./data"),
           csv_file = str_c(path = "./data/", participant)) %>% 
    mutate(data = map(csv_file, read_csv)) %>% 
    unnest 
```
Using map, I read a string with the complete file names using the "read_csv" function.

## Part C

- Tidy the result; manipulate file names to include control arm and subject ID, make sure weekly observations are “tidy”, and do any other tidying that’s necessary

```{r}
longitudinal_df =
    tibble(participant = list.files(path = "./data"),
           csv_file = str_c(path = "./data/", participant)) %>% 
    mutate(data = map(csv_file, read_csv)) %>% 
    unnest %>%
    separate(participant, into = c("participant_id", "trash"), sep = ".c") %>% 
  mutate(study_arm = participant_id) %>%
  mutate(study_arm = str_replace(study_arm, "con", "control")) %>% 
  mutate(study_arm = str_replace(study_arm, "exp", "experiment")) %>% 
  separate(study_arm, into = c("study_arm", "trash1"), sep = "_") %>% 
  select(participant_id, study_arm, everything(), -starts_with("trash"), -csv_file) %>% 
  janitor::clean_names() %>% 
  gather(key = week, value = observation, week_1:week_8) %>% 
  separate(week, into = c("trash", "week"), sep = "_") %>% 
  select(-trash) 
```
Building on Part B, I tidied my newly created data set by renaming some variables, removing unnecessary variables, creating a variable based on study arm, and gathering the week variables into one column. 

## Part D

- Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups.

```{r}
longitudinal_df %>% 
  ggplot(aes(x = week, y = observation, group = participant_id, color = study_arm)) +
  geom_path() + 
  labs(title = "Observations over Time per Subject",
       x = "Time (weeks)",
       y = "Observations") + 
  viridis::scale_color_viridis(
    name = "Study arm", 
    discrete = TRUE) +
  theme(plot.title = element_text(hjust = 0.5))
```
 
### Plot description:

Given the spaghetti plot above, it appears that subjects in the **"experiment"** arm have _higher_ observations overall compared to the **"control"** arm.  

While there is some overlap/crossing of lines between the "control" and "experiment" subjects with regard to observations, it seems that the highest observation among subjects in the "control" arm is at around 4.5 compared to above 7.5 among subjects in the "experiment" arm. The lowest observation is slightly above -2.5 among subjects in the "control" arm compared to just above -1 among subjects in the "experiment" arm.

# Problem 2

## Part A

- Describe the raw data. 

```{r}
wp_murders_df = read_csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv")

str(wp_murders_df)

table(wp_murders_df$victim_sex)
```
There are **52,179 observations** with **12 variables** in this dataset, which are "uid", "reported_date", "victim_last", "victim_first", "victim_race", victim_age", "victim_sex", "city", "state", "lat", "lon", and "disposition".  
The data include the _location_ of the killing (which is defined by 4 variables "city", "state", "lat", and "lon"), whether an _arrest_ was made (defined by the variable "disposition"), the _reported date_ of the homicide ("reported_date") and information about each victim, such as _name_, _race_, _sex_, _age_, and their _homicide ID_ (captured by the variables "victim_last", "victim_first", "victim_race", victim_sex" "victim_age", and "uid").  

Of the 52,179 homicides, **7,209 were female**, **40,739 were male**, and 4,231 were unknown.  



- Create a city_state variable (e.g. “Baltimore, MD”) 
- Summarize within cities to obtain the total number of homicides and the number of unsolved homicides (those for which the disposition is “Closed without arrest” or “Open/No arrest”).

